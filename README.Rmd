---
output:
  md_document:
    variant: markdown_github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/",
  dev = "png",
  dpi = 150,
  fig.asp = 0.8,
  fig.width = 10,
  out.width = "60%",
  fig.align = "center"
)
set.seed(298)
library(nortest)
```


# **nortsTest: An R package for testing normal distribution in stationary time series**

prueba

**nortsTest** is an R package for assessing normal distribution, in numeric and time series data. The package works as an extension of [nortest](https://cran.r-project.org/web/packages/nortest/index.html) package that checks Gaussian distribution assumptions on independent data. The four principal package's functions are:

+ epps.test function that implements the [Epps test](https://projecteuclid.org/euclid.aos/1176350618), 

+ lobato.test function with the [Lobato and Velsasco](https://www.researchgate.net/publication/23564884),

+ vavra.test function with the implements[Psaradaki and Vavra](http://www.applied-econometrics.com/html), 

+ rp.test with the random projections test of [Nieto-Reyes, Cuesta-Albertos and Gamboa](https://www.sciencedirect.com/science/article/pii/S0167947314000243?via%3Dihub).

Additionally, inspired in the function *check.residuals()* of the [forecast package](https://www.jstatsoft.org/article/view/v027i03), we provide the **check\_residuals** methods and plots for checking models assumptions using the estimated residuals. The function checks stationarity, homoscedasticity and normal distribution, presenting a report of the used test and conclusions.


# Checking normal distribution in time series

```{r, message=FALSE,warning=FALSE}
library(nortstest)
```


To check normal distribution hypothesis in a random sample you can use the classical hypothesis test such as *Shapiro & Wilk, Anderson & Darling, Cramer-von Mises, Lillie, Pearson and Shapiro Francia* tests adapted from the nortest package, and the *Jarque & Bera* from the **tseries* package.
, Lobatos-Velascos, Epps and Vavras goodness of fit tests are implemented as well. 

As a simple example, we generate a stationary ARMA(1,1) model simulated using an normal distribution, and perform the Epps test, the initial hypothesis is that the process follows a normal distribution. The *normal.test* function, calls the epp.test(), and returns a *htest* class.

```{r}
x = arima.sim(100,model = list(ar = 0.32,ma = 0.25),rand.gen = rt,df = 7)
ad.test(x)
```

```{r}
lobato.test(x)
```


In the next example we generate a stationary ar(2) model, using an exponential distribution, and perform the Lobato and Velasco's normality test, In addition we print the test's conclusion using a significance of $alpha = 0.08$

```{r}
x = arima.sim(250,model = list(ar =c(0.2,0.57)),rand.gen = rexp,rate = 1)
epps.test(x)
```

# Checking residuals in time series models

As an example, we analyze the monthly deaths from lung diseases in the Uk (1974-1979), and try to establish a relationship in the amount of deaths between male and female. We propose a classic linear model, and a dynamic regression, in both models we check the fit and parameter estimation, visualize the model residuals for diagnostic, and finally normality and stationarity tests. 

```{r}
lungDeaths = cbind(male = mdeaths,female = fdeaths)
autoplot(lungDeaths) +labs(title = "Monthly Deaths Lung Diseases UK",y = "Lung Deaths")
```

In the linear model, all the estimated parameters are significant,  Adjusted $R^2$ is close to one indicating a good model fit, and the significance of the  F-test validates the model.

```{r}
mod1 = lm(male~female,data = lungDeaths)
summary(mod1)
```

In counterpart, the time series plot reveals some dependency on the data, and a dynamic regression could offer better results, the estimated parameters in this new model are significant as well.

```{r}
mod2 = Arima(lungDeaths[,1],xreg = lungDeaths[,2],order = c(0,1,1))
summary(mod2)
```

Now we perform a visual comparative of the two models, the linear model residuals, do not seem to have a Gaussian distribution (*left qqplot and histogram*) and the acf plots shows some correlated structure. 
In contrast, the histograms and qq-plots of the dynamic regression indicate that the residuals have a normal distribution, and the acf plots do not show a strong correlation

```{r}
g = plot_compare(model1 = mod1,model2 = mod2,name1 = "Linear model",name2 = "Dynamic Regression")
g
```


The residuals diagnostic show  that the dynamic regression adjust better to the data than a simple linear model. Finally, we check the selected model assumptions, for it  we use the *check_residuals()* method, the function performs a unit root, seasonal and arch effect tests to check stationarity, and a normality test to check the Gaussian distribution.

If the given model is for time series analysis, the check_residuals() function will perform the *Epps test* for stationary process by default, in other case it will perform the *shapiro & wilk test* for random samples.

```{r}
check_residuals(y = mod2,unit_root = "pp",normality = "lobatos")
```

## Accepted models for residual check

Currently our check_residuals(), check_plot(), and plot compare methods are valid for the current models and classes:

+ **ts**: for uni variate time series

+ **numeric**: for numeric vectors

+ **arima0**: from the stats package

+ **Arima**: from the forecast package

+ **fGARCH**: from the fGarch package

+ **lm**: from the stats package

+ **glm**: from the stats package

+ **Holt and Winters**: from the stats and forecast package

+ **ets**: from the forecast package

+ **forecast methods**: from the forecast package.

For overloading more functions, methods or packages, please made a pull request or send  a mail to: asael_am\@hotmail.com 

# References

 + Epps, T.W. (1987). Testing that a stationary time series is Gaussian. **The Annals of Statistic**. 15(4), 1683-1698. Url: (http://www.jstor.org/stable/2336512). [doi:10.1214/aos/1176350618](http://www.jstor.org/stable/2336512)

 + Nieto-Reyes, A., Cuesta-Albertos, J. & Gamboa, F. (2014). A random-projection based test of Gaussianity for stationary processes. *Computational Statistics & Data Analysis, Elsevier*. 75(C), 124-141. url:(http://www.sciencedirect.com/science/article/pii/S0167947314000243). [doi:https://doi.org/10.1016/j.csda.2014.01.013}](ttp://www.sciencedirect.com/science/article/pii/S0167947314000243)

 + Lobato, I., & Velasco, C. (2004). A simple test of normality for time series. *Journal Econometric Theory*. 20(4), 671-689. [doi:(10.1017/S0266466604204030)].

 + Psaradakis, Z. & Vavra, M. (2017). A distance test of normality for a wide class of stationary process. \emph{Journal of Econometrics and Statistics}. 2, 50-60. url:(http://www.sciencedirect.com/science/article/pii/S2452306216300296).
[doi: https://doi.org/10.1016/j.ecosta.2016.11.005](http://www.sciencedirect.com/science/article/pii/S2452306216300296)

 + Hyndman, R. & Khandakar, Y. (2008). Automatic time series forecasting: the forecast package for R. \emph{Journal of Statistical Software}. 26(3), 1-22. Url: (http://www.jstatsoft.org/article/view/v027i03).

